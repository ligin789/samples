import React from 'react';
import { errorAlert } from "../../components/atoms/CustomAlert";
// import { BASE_URL } from "../../services/http/service";
import { getItem } from "../../getAuth";

export const fetchDownloadCSV = async (url, name) => {
    try {
      const sessionToken = getItem({ key: "SMXInternalApplication" });
      const response = await fetch(url, {
        method: "get",
        headers: new Headers({
          Authorization: `Bearer ${sessionToken}`,
        }),
        data
      });
      const data = await response.text();
      const blob = new Blob([data], { type: "data:text/csv;charset=utf-8," });
      const blobUrl = window.URL.createObjectURL(blob);
  
      const a = document.createElement("a");
      a.download = name;
      a.href = blobUrl;
      a.dataset.downloadurl = ["text/csv", a.download, a.href].join(":");
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(blobUrl);
      }, 5000);
    } catch (err) {
      errorAlert({
        title: "Request Failed",
        content: err.message,
      });
      console.log(err.message, "failed to download csv");
    }
  };

import { errorAlert } from "../../components/atoms/CustomAlert";
import { getItem } from "../../getAuth";

export const fetchDownloadXLSX = async (url, name) => {
    try {
      const sessionToken = getItem({ key: "SMXInternalApplication" });
      const response = await fetch(url, {
        method: "get",
        headers: new Headers({
          Authorization: `Bearer ${sessionToken}`,
        }),
        data
      });
      const type = response.headers['content-type'];	
      const data = await response.blob();
      const blob = new Blob([data], { type: type, encoding: 'UTF-8' });
      const blobUrl = window.URL.createObjectURL(blob);
  
      const a = document.createElement("a");
      a.download = name;
      a.href = blobUrl;
      // a.dataset.downloadurl = ["application/json", a.download, a.href].join(":");
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(blobUrl);
      }, 5000);
    } catch (err) {
      errorAlert({
        title: "Request Failed",
        content: err.message,
      });
      console.log(err.message, "failed to download xlsx");
    }
};
